var profileHuaDian=profileHuaDian||{};profileHuaDian.init=function(){this.registAllMessage(),this.initCreateRoomOpts(),this.initData()},profileHuaDian.initData=function(){this.initGameData(),this.initRoomData()},profileHuaDian.initGameData=function(){profileHuaDian.PiaoInfo={}},profileHuaDian.initRoomData=function(){profileHuaDian.roomInfo={},profileHuaDian.resultData={},profileHuaDian.roomInfo.isPiaoFinish=!1,cc.log("init Hd roomData")},profileHuaDian.initCreateRoomOpts=function(){var a=cc.sys.localStorage.getItem("createRoomOpts_huadian");null==a?(profileHuaDian.createRoomOpts={},profileHuaDian.createRoomOpts.roundRule=63,profileHuaDian.createRoomOpts.roundType=1,profileHuaDian.createRoomOpts.roundMax=16,profileHuaDian.createRoomOpts.costType=1,profileHuaDian.createRoomOpts.joinermax=2,profileHuaDian.createRoomOpts.clubId=null,profileHuaDian.createRoomOpts.scoreBase=1,profileHuaDian.createRoomOpts.bossType=1,profileHuaDian.createRoomOpts.isBigFan=1,profileHuaDian.createRoomOpts.piao=0,profileHuaDian.createRoomOpts.mobaojiafen=0,profileHuaDian.createRoomOpts.anBao=1,profileHuaDian.createRoomOpts.fenZhang=0,profileHuaDian.createRoomOpts.isLouDianPaoDouble=0,profileHuaDian.createRoomOpts.scoreLv=0):profileHuaDian.createRoomOpts=JSON.parse(a)},profileHuaDian.saveCreateRoomOpts=function(){null!=profileHuaDian.createRoomOpts&&null!=profileHuaDian.createRoomOpts&&(cc.log("saveCreateRoomOpts="+JSON.stringify(profileHuaDian.createRoomOpts)),cc.sys.localStorage.setItem("createRoomOpts_huadian",JSON.stringify(profileHuaDian.createRoomOpts)))},profileHuaDian.registAllMessage=function(){console.log("----- 初始化桦甸消息"),GameNet.getInstance().setCallBack("onMahjongStartRun",function(a){WriteLog("~~~~~~~~~~~onMahjongStartRunHD :~~~~~~~~~~~~~~"+JSON.stringify(a)),GameData.game=GameData.game||GameData.initGameData(),GameData.game.gameStart=!0,GameData.game.cardleft=a.remainCardCount;for(var e=0;e<a.playerGameInfo.length;e++){if(GameData.cards[a.playerGameInfo[e].uid]=void 0===GameData.cards[a.playerGameInfo[e].uid]?{}:GameData.cards[a.playerGameInfo[e].uid],GameData.cards[a.playerGameInfo[e].uid].hand=a.playerGameInfo[e].handCards,GameData.cards[a.playerGameInfo[e].uid].handnum=a.playerGameInfo[e].countOfHandCards,GameData.cards[a.playerGameInfo[e].uid].chi=a.playerGameInfo[e].cardsChi,GameData.cards[a.playerGameInfo[e].uid].peng=a.playerGameInfo[e].cardsPeng,GameData.cards[a.playerGameInfo[e].uid].gang=a.playerGameInfo[e].cardsGang,GameData.cards[a.playerGameInfo[e].uid].dis=a.playerGameInfo[e].cardsPast,GameData.game.noActions=!1,GameData.player[a.playerGameInfo[e].uid]=a.playerGameInfo[e],a.playerGameInfo[e].cardLastAssigned?(GameData.cards[a.playerGameInfo[e].uid].hand.push(a.playerGameInfo[e].cardLastAssigned),GameData.game.obtain=a.playerGameInfo[e].cardLastAssigned):a.playerGameInfo[e].uid==GameData.player.uid&&(GameData.game.obtain=-1),1==a.playerGameInfo[e].isAssignedCard&&GameData.cards[a.playerGameInfo[e].uid].handnum++,a.playerGameInfo[e].operationList&&(GameData.operations[a.playerGameInfo[e].uid]=a.playerGameInfo[e].operationList),a.playerGameInfo[e].isBoss){GameData.game.turn=a.playerGameInfo[e].uid;var n=0==e?0:e-1;GameData.game.lastdisUid=a.playerGameInfo[n].uid,GameData.game.zhuangUid=a.playerGameInfo[e].uid,GameData.game.checkPass.onGoingUserId=a.playerGameInfo[e].uid}a.playerGameInfo[e].tingReady?GameData.cards[a.playerGameInfo[e].uid].tingData=a.playerGameInfo[e].tingReady:GameData.cards[a.playerGameInfo[e].uid].tingData=null,1==a.playerGameInfo[e].isTing&&1==a.playerGameInfo[e].isZiMoHuOnly?GameData.cards[a.playerGameInfo[e].uid].tingState=1:1==a.playerGameInfo[e].isTing&&0==a.playerGameInfo[e].isZiMoHuOnly?GameData.cards[a.playerGameInfo[e].uid].tingState=2:0==a.playerGameInfo[e].isTing&&0==a.playerGameInfo[e].isZiMoHuOnly&&(GameData.cards[a.playerGameInfo[e].uid].tingState=0)}GameData.game.initcards=!0,sendEvent("onGameTurn",a.onGoingUserId),sendEvent("initZhuangInfo"),sendEvent("onMahjongStartRun")}),GameNet.getInstance().setCallBack("onHuaDianPiaoInfo",function(a){WriteLog("~~~~~~~~~~~onHuaDianPiaoInfoHD :~~~~~~~~~~~~~~"+JSON.stringify(a)),profileHuaDian.PiaoInfo=a,cc.log("profileHuaDian.roomInfo.isPiaoFinish:"+profileHuaDian.roomInfo.isPiaoFinish),a.runState>=HuaDian.RunStateEmnum.PIAO&&!profileHuaDian.roomInfo.isPiaoFinish&&(sendEvent("onStarPiao"),a.runState==HuaDian.RunStateEmnum.BEGIN&&(profileHuaDian.roomInfo.isPiaoFinish=!profileHuaDian.roomInfo.isPiaoFinish))}),GameNet.getInstance().setCallBack("onRegularCircle",function(a){WriteLog("~~~~~~~~~~~onRegularCircleHD :~~~~~~~~~~~~~~"+JSON.stringify(a)),GameData.game.cardleft=a.remainCardCount,GameData.game.turn=a.onGoingUserId,GameData.game.checkPass=a,GameData.game.lastdisCard=a.showCard[0],GameData.game.lastdisUid=a.currentPlayCardUser;for(var e=0;e<a.playerGameInfo.length;e++)GameData.cards[a.playerGameInfo[e].uid].handnum=a.playerGameInfo[e].countOfHandCards,GameData.cards[a.playerGameInfo[e].uid].hand=a.playerGameInfo[e].handCards,GameData.cards[a.playerGameInfo[e].uid].chi=a.playerGameInfo[e].cardsChi,GameData.cards[a.playerGameInfo[e].uid].peng=a.playerGameInfo[e].cardsPeng,GameData.cards[a.playerGameInfo[e].uid].gang=a.playerGameInfo[e].cardsGang,GameData.cards[a.playerGameInfo[e].uid].dis=a.playerGameInfo[e].cardsPast,GameData.player[a.playerGameInfo[e].uid]=a.playerGameInfo[e],a.playerGameInfo[e].cardLastAssigned?(GameData.cards[a.playerGameInfo[e].uid].hand.push(a.playerGameInfo[e].cardLastAssigned),GameData.game.obtain=a.playerGameInfo[e].cardLastAssigned):a.playerGameInfo[e].uid==GameData.player.uid&&(GameData.game.obtain=-1),1==a.playerGameInfo[e].isAssignedCard&&GameData.cards[a.playerGameInfo[e].uid].handnum++,a.playerGameInfo[e].operationList&&(GameData.operations[a.playerGameInfo[e].uid]=a.playerGameInfo[e].operationList),a.playerGameInfo[e].tingReady?GameData.cards[a.playerGameInfo[e].uid].tingData=a.playerGameInfo[e].tingReady:GameData.cards[a.playerGameInfo[e].uid].tingData=null,1==a.playerGameInfo[e].isTing&&1==a.playerGameInfo[e].isZiMoHuOnly?GameData.cards[a.playerGameInfo[e].uid].tingState=1:1==a.playerGameInfo[e].isTing&&0==a.playerGameInfo[e].isZiMoHuOnly?GameData.cards[a.playerGameInfo[e].uid].tingState=2:0==a.playerGameInfo[e].isTing&&0==a.playerGameInfo[e].isZiMoHuOnly&&(GameData.cards[a.playerGameInfo[e].uid].tingState=0),2==a.playerGameInfo[e].isWin&&sendEvent("dianPao",a.playerGameInfo[e].uid);var n={userId:a.currentPlayCardUser,card:a.showCard[0]};if(a.operation||sendEvent("onCardDis",n),a.operation){var r=a.operation.operation;if(r==HuaDian.OPERATION.OPERATION_GONGGANG||r==HuaDian.OPERATION.OPERATION_ANGANG||r==HuaDian.OPERATION.OPERATION_MINGGANG||r==HuaDian.OPERATION.OPERATION_MINGGANG||r==HuaDian.OPERATION.OPERATION_GONGGANG_TING||r==HuaDian.OPERATION.OPERATION_ANGANG_TING||r==HuaDian.OPERATION.OPERATION_MINGGANG_TING?sendEvent("onCardGang",a.operation):r==HuaDian.OPERATION.OPERATION_PENG||r==HuaDian.OPERATION.OPERATION_PENG_TING?sendEvent("onCardPeng",a.operation):r==HuaDian.OPERATION.OPERATION_DIANPAO_HU||r==HuaDian.OPERATION.OPERATION_HU||r==HuaDian.OPERATION.OPERATION_QIANGGANG_HU?sendEvent("onCardHu",a.operation):r!=HuaDian.OPERATION.OPERATION_CHI&&r!=HuaDian.OPERATION.OPERATION_CHI_TING||sendEvent("onCardChi",a.operation),r==HuaDian.OPERATION.OPERATION_TING||r==HuaDian.OPERATION.OPERATION_CHI_TING||r==HuaDian.OPERATION.OPERATION_PENG_TING||r==HuaDian.OPERATION.OPERATION_GONGGANG_TING||r==HuaDian.OPERATION.OPERATION_ANGANG_TING||r==HuaDian.OPERATION.OPERATION_MINGGANG_TING){var t={userId:a.currentPlayCardUser,type:r};sendEvent("onCardTing",t),setTimeout(function(){sendEvent("onCardDis",n)},1e3)}}if(a.bao){var o=0;1e3!=a.bao.oldBaoCard&&-1!=a.bao.oldBaoCard&&(o=1,GameData.game.cardHuier1=a.bao.baoCard),0==a.bao.oldBaoCard&&(o=2);var i={uid:a.currentPlayCardUser,type:o};sendEvent("onCardBao",i)}a.baoCardId&&(GameData.game.cardHuier1=a.baoCardId),sendEvent("onGameTurn",a.onGoingUserId),sendEvent("onRegularCircle")}),GameNet.getInstance().setCallBack("onHuaDianMahjongReconnecet",function(a){WriteLog("~~~~~~~~~~~onHuaDianMahjongReconnecetHD :~~~~~~~~~~~~~~"+JSON.stringify(a)),GameData.game=GameData.game||GameData.initGameData(),GameData.game.gameStart=!0,GameData.game.cardleft=a.remainCardCount,GameData.game.initcards=!0,GameData.game.turn=a.onGoingUserId,GameData.game.checkPass=a,GameData.game.lastdisCard=a.showCard[a.showCard.length-1],GameData.game.lastdisUid=a.currentPlayCardUser;for(var e=0;e<a.playerGameInfo.length;e++)GameData.cards[a.playerGameInfo[e].uid]=void 0===GameData.cards[a.playerGameInfo[e].uid]?{}:GameData.cards[a.playerGameInfo[e].uid],GameData.cards[a.playerGameInfo[e].uid].hand=a.playerGameInfo[e].handCards,GameData.cards[a.playerGameInfo[e].uid].handnum=a.playerGameInfo[e].countOfHandCards,GameData.cards[a.playerGameInfo[e].uid].chi=a.playerGameInfo[e].cardsChi,GameData.cards[a.playerGameInfo[e].uid].peng=a.playerGameInfo[e].cardsPeng,GameData.cards[a.playerGameInfo[e].uid].gang=a.playerGameInfo[e].cardsGang,GameData.cards[a.playerGameInfo[e].uid].dis=a.playerGameInfo[e].cardsPast,GameData.player[a.playerGameInfo[e].uid]=a.playerGameInfo[e],GameData.game.noActions=!1,a.playerGameInfo[e].cardLastAssigned?(GameData.cards[a.playerGameInfo[e].uid].hand.push(a.playerGameInfo[e].cardLastAssigned),GameData.game.obtain=a.playerGameInfo[e].cardLastAssigned):a.playerGameInfo[e].uid==GameData.player.uid&&(GameData.game.obtain=-1),1==a.playerGameInfo[e].isAssignedCard&&GameData.cards[a.playerGameInfo[e].uid].handnum++,a.playerGameInfo[e].isBoss&&(GameData.game.zhuangUid=a.playerGameInfo[e].uid),a.playerGameInfo[e].operationList&&(GameData.operations[a.playerGameInfo[e].uid]=a.playerGameInfo[e].operationList),a.playerGameInfo[e].tingReady?GameData.cards[a.playerGameInfo[e].uid].tingData=a.playerGameInfo[e].tingReady:GameData.cards[a.playerGameInfo[e].uid].tingData=null,1==a.playerGameInfo[e].isTing&&1==a.playerGameInfo[e].isZiMoHuOnly?GameData.cards[a.playerGameInfo[e].uid].tingState=1:1==a.playerGameInfo[e].isTing&&0==a.playerGameInfo[e].isZiMoHuOnly?GameData.cards[a.playerGameInfo[e].uid].tingState=2:0==a.playerGameInfo[e].isTing&&0==a.playerGameInfo[e].isZiMoHuOnly&&(GameData.cards[a.playerGameInfo[e].uid].tingState=0);a.baoCardId&&(GameData.game.cardHuier1=a.baoCardId),sendEvent("onGameTurn",a.onGoingUserId),sendEvent("onHuaDianMahjongReconnecet")}),GameNet.getInstance().setCallBack("onMahjongRunEnd",function(a){WriteLog("~~~~~~~~~~~onMahjongRunEndHD :~~~~~~~~~~~~~~"+JSON.stringify(a)),profileHuaDian.resultData=a,profileHuaDian.roomInfo.isPiaoFinish=!1;for(var e=0;e<a.playerRecord.length;e++){GameData.cards[a.playerRecord[e].uid].Resulthand=[];for(var n=0;n<a.playerRecord[e].handCards.length;n++)GameData.cards[a.playerRecord[e].uid].Resulthand.push({card:a.playerRecord[e].handCards[n],type:0});GameData.cards[a.playerRecord[e].uid].peng=a.playerRecord[e].pengCards,GameData.cards[a.playerRecord[e].uid].gang=a.playerRecord[e].gangCards,GameData.cards[a.playerRecord[e].uid].chi=a.playerRecord[e].chiCards,GameData.cards[a.playerRecord[e].uid].handnum=a.playerRecord[e].handCards.length,GameData.ResultScoreInfo[a.playerRecord[e].uid]=a.playerRecord[e].socreInfo,GameData.scores[a.playerRecord[e].uid]=a.playerRecord[e].socreInfo.totalRunScore,GameData.ResultData[a.playerRecord[e].uid]=a.playerRecord[e],a.playerRecord[e].cardLastAssigned&&(GameData.cards[a.playerRecord[e].uid].Resulthand.push({card:a.playerRecord[e].cardLastAssigned[0],type:1}),GameData.game.winnerObtain=a.playerRecord[e].cardLastAssigned,GameData.cards[a.playerRecord[e].uid].handnum++)}GameData.game.gameStart=!1,sendEvent("onMahjongRunEnd")}),GameNet.getInstance().setCallBack("onMahjongRoomEnd",function(a){WriteLog("~~~~~~~~~~~onMahjongRoomEnd :~~~~~~~~~~~~~~"+JSON.stringify(a));for(var e=0;e<a.playerList.length;e++)GameData.SummaryData[a.playerList[e].uid]=a.playerList[e];GameData.roomClose=!0,sendEvent("onShowSummary")}),GameNet.getInstance().setCallBack("onPushErrorMsg",function(a){WriteLog("~~~~~~~~~~~onPushErrorMsgHD  :~~~~~~~~~~~~~~"+JSON.stringify(a)),sendEvent("onPushErrorMsg",a)})},profileHuaDian.unregistAllMessage=function(){console.log("----- 注销桦甸消息"),GameNet.getInstance().removeAllListeners("onMahjongStartRun"),GameNet.getInstance().removeAllListeners("onHuaDianMahjongReconnecet"),GameNet.getInstance().removeAllListeners("onMahjongStartRun"),GameNet.getInstance().removeAllListeners("onRegularCircle"),GameNet.getInstance().removeAllListeners("onHuaDianPiaoInfo"),GameNet.getInstance().removeAllListeners("onMahjongRunEnd"),GameNet.getInstance().removeAllListeners("onMahjongRoomEnd"),GameNet.getInstance().removeAllListeners("onPushErrorMsg")},profileHuaDian.getPlayerOperationsByUid=function(a){for(var e in cc.log("GameData.operations:"+JSON.stringify(GameData.operations)),GameData.operations)if(a==e)return GameData.operations[e];return null},profileHuaDian.getTingStateByUid=function(a){for(var e in GameData.cards)if(a==e)return 1==GameData.cards[e].tingState||2==GameData.cards[e].tingState;return null},profileHuaDian.getResultScoreInfoByUid=function(a){for(var e in GameData.ResultScoreInfo)if(a==e)return GameData.ResultScoreInfo[e];return null},profileHuaDian.canHu=function(){for(var a in GameData.operations)if(GameData.player.uid==a){for(var e=0,n=0;n<GameData.operations[a].length;n++){if(GameData.operations[a][n]==HuaDian.OPERATION.OPERATION_DIANPAO_HU||GameData.operations[a][n]==HuaDian.OPERATION.OPERATION_HU||GameData.operations[a][n]==HuaDian.OPERATION.OPERATION_QIANGGANG_HU)return!0;e++}if(e==GameData.operations[a].length)return!1}return null},profileHuaDian.canGang=function(){for(var a in GameData.operations)if(GameData.player.uid==a){for(var e=0,n=0;n<GameData.operations[a].length;n++){if(GameData.operations[a][n]==HuaDian.OPERATION.OPERATION_GONGGANG||GameData.operations[a][n]==HuaDian.OPERATION.OPERATION_ANGANG||GameData.operations[a][n]==HuaDian.OPERATION.OPERATION_MINGGANG)return!0;e++}if(e==GameData.operations[a].length)return!1}return null},profileHuaDian.canTing=function(){for(var a in GameData.operations)if(GameData.player.uid==a){for(var e=0;e<GameData.operations[a].length;e++){var n=0;if(GameData.operations[a][e]==HuaDian.OPERATION.OPERATION_TING||GameData.operations[a][e]==HuaDian.OPERATION.OPERATION_CHI_TING||GameData.operations[a][e]==HuaDian.OPERATION.OPERATION_GONGGANG_TING||GameData.operations[a][e]==HuaDian.OPERATION.OPERATION_ANGANG_TING||GameData.operations[a][e]==HuaDian.OPERATION.OPERATION_MINGGANG_TING||GameData.operations[a][e]==HuaDian.OPERATION.OPERATION_PENG_TING)return!0;n++}if(n==GameData.operations[a].length)return!1}return null},profileHuaDian.getGangCardByUid=function(a,e){var n=GameData.getHandCards(a),r=GameData.getPengCards(a);switch(e){case HuaDian.OPERATION.OPERATION_MINGGANG:for(var t in r)for(var o=0;o<n.length;o++)if(r[t].cards[0]==n[o])return{card:n[o],type:0};break;case HuaDian.OPERATION.OPERATION_ANGANG:n.sort();for(o=0;o<n.length;o++)if(n[o]==n[o+1]&&n[o]==n[o+2]&&n[o]==n[o+3])return{card:n[o],type:1};break;case HuaDian.OPERATION.OPERATION_GONGGANG:n.sort();for(o=0;o<n.length;o++)if(n[o]==n[o+1]&&n[o]==n[o+2]&&n[o]==GameData.game.lastdisCard)return{card:GameData.game.lastdisCard,type:0}}},profileHuaDian.summaryDataByUid=function(a){for(var e in GameData.SummaryData)if(e==a)return GameData.SummaryData[e];return null},profileHuaDian.checkIsTingPlayer=function(){var a=0;for(var e in GameData.cards){if(1==GameData.cards[e].tingState||2==GameData.cards[e].tingState)return!0;a++}if(a==Object.keys(GameData.cards).length)return!1},profileHuaDian.getTurnByUid=function(){return profileHuaDian.isNextPlayer(GameData.game.lastdisUid,GameData.game.turn)?GameData.game.turn:GameData.game.lastdisUid},profileHuaDian.isNextPlayer=function(a,e){if(!a)return!0;var n=GameData.getPlayerIndex(a),r=GameData.getPlayerIndex(e);return n==GameData.joiners.length-1&&0==r||r-n==1},profileHuaDian.getPiaoStateByUid=function(a){for(var e in profileHuaDian.PiaoInfo.result)if(profileHuaDian.PiaoInfo.result[e].userId==a)return profileHuaDian.PiaoInfo.result[e].hasPiao},profileHuaDian.allPiaoState=function(){var a=0;for(var e in profileHuaDian.PiaoInfo.result)2==profileHuaDian.PiaoInfo.result[e].hasPiao&&a++;return a==Object.keys(profileHuaDian.PiaoInfo.result).length},profileHuaDian.getCardIndexByUid=function(a,e){var n=GameData.getPlayerIndex(a),r=GameData.getPlayerIndex(e),t=n-r;cc.log(n+"222"+r);var o=0;if(2==GameData.room.opts.joinermax)return o=2;switch(t){case 1:o=1;break;case-1:o=3;break;case 2:case-2:o=2;break;case-3:o=1;break;case 3:o=3}return o};